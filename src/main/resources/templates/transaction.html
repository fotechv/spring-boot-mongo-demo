<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Transactions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <nav class="mb-4 d-flex gap-2">
        <a href="/customer" class="btn btn-outline-primary">Customer</a>
        <a href="/transaction" class="btn btn-primary">Transaction</a>
    </nav>

    <div class="d-flex align-items-end gap-2 mb-3">
        <div>
            <label for="seedCount" class="form-label mb-1">Seed count</label>
            <input id="seedCount" type="number" value="100" min="1" class="form-control" style="width:140px" />
        </div>
        <button id="seedBtn" class="btn btn-success">Tạo transaction tự động</button>
        <button id="reloadBtn" class="btn btn-secondary">Reload danh sách</button>
    </div>

    <div class="card mb-4">
        <div class="card-header">Kết quả seed</div>
        <div class="card-body">
            <pre id="out" class="mb-0">(chưa có)</pre>
        </div>
    </div>

    <div class="d-flex align-items-end gap-2 mb-2">
        <div>
            <label for="page" class="form-label mb-1">Page</label>
            <input id="page" type="number" value="0" min="0" class="form-control" style="width:120px" />
        </div>
        <div>
            <label for="size" class="form-label mb-1">Size</label>
            <input id="size" type="number" value="10" min="1" class="form-control" style="width:120px" />
        </div>
        <button id="loadBtn" class="btn btn-primary">Load</button>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
            <tr>
                <th style="width:26%">ID</th>
                <th style="width:20%">Customer ID</th>
                <th style="width:12%">Amount</th>
                <th style="width:22%">Created At</th>
                <th style="width:20%">Description</th>
            </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
    <div id="pager" class="text-muted small"></div>
</div>

<script>
    function fmtMoney(x){ return (x==null)?'':Number(x).toFixed ? Number(x).toFixed(2) : x; }

    async function loadTransactions() {
        const page = document.getElementById('page').value || 0;
        const size = document.getElementById('size').value || 10;
        const res = await fetch(`/api/transactions?page=${page}&size=${size}`);
        const data = await res.json();

        const tbody = document.getElementById('tbody');
        tbody.innerHTML = '';
        data.content.forEach(t => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${t.id ?? ''}</td>
                        <td>${t.customerId ?? ''}</td>
                        <td>${t.amount ?? ''}</td>
                        <td>${t.createdAt ?? ''}</td>
                        <td>${t.description ?? ''}</td>`;
            tbody.appendChild(tr);
        });
        document.getElementById('pager').textContent =
            `page=${data.number} / totalPages=${data.totalPages} • totalElements=${data.totalElements}`;
    }

    document.getElementById('seedBtn').addEventListener('click', async () => {
        const count = document.getElementById('seedCount').value || 100;
        const res = await fetch(`/api/transactions/seed?count=${count}`, { method: 'POST' });
        const json = await res.json();
        document.getElementById('out').textContent = JSON.stringify(json, null, 2);
        loadTransactions();
    });

    document.getElementById('loadBtn').addEventListener('click', loadTransactions);
    document.getElementById('reloadBtn').addEventListener('click', loadTransactions);

    // load lần đầu
    loadTransactions();
</script>
</body>
</html>
